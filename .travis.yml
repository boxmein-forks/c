if: (tag =~ ^v) AND (branch = master)

language: generic

env:
    global:
        - IS_RELEASE=$(git ls-remote origin | grep "$TRAVIS_COMMIT\s\+refs/heads/master")

services:
  - docker

stages:
  - DockerHub Release
  - GitHub Release

jobs:
  include:
    - stage: DockerHub Release
      deploy:
          provider: script
          script: server/travis.sh

    - stage: GitHub Release
      script: ./travis.sh
      deploy:
        provider: releases
        file_glob: true
        file: dist/*
        api_key: $GITHUB_OAUTH_TOKEN
        skip_cleanup: true